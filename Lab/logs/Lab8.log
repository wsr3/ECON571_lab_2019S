---------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\Dropbox\2019S\571\ECON571_lab_2019S\Lab\logs/Lab8.log
  log type:  text
 opened on:   2 Apr 2019, 11:34:18

. use data/loanapp

. * http://fmwww.bc.edu/ec-p/data/wooldridge/loanapp.des
. 
. * Check for missing values
. codebook approve male black hispan atotinc yjob unem hrat married ///
>         dep sch chis pubrec mortno vr

---------------------------------------------------------------------------------------------------------------------------------
approve                                                                                                               (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                           244  0
                         1,745  1

---------------------------------------------------------------------------------------------------------------------------------
male                                                                                                                  (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  15/1,989

            tabulation:  Freq.  Value
                           369  0
                         1,605  1
                            15  .

---------------------------------------------------------------------------------------------------------------------------------
black                                                                                                                 (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,792  0
                           197  1

---------------------------------------------------------------------------------------------------------------------------------
hispan                                                                                                                (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,878  0
                           111  1

---------------------------------------------------------------------------------------------------------------------------------
atotinc                                                                                                               (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,81000]                    units:  1
         unique values:  1,349                    missing .:  0/1,989

                  mean:   5195.55
              std. dev:   5269.06

           percentiles:        10%       25%       50%       75%       90%
                              2235      2876      3813      5596      8881

---------------------------------------------------------------------------------------------------------------------------------
yjob                                                                                                                  (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,9]                        units:  1
         unique values:  4                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,364  0
                           581  1
                            28  6
                            16  9

---------------------------------------------------------------------------------------------------------------------------------
unem                                                                                                                  (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1.8,10.6]                   units:  .1
         unique values:  10                       missing .:  0/1,989

                  mean:    3.8823
              std. dev:   2.16413

           percentiles:        10%       25%       50%       75%       90%
                                 2       3.1       3.2       3.9       5.3

---------------------------------------------------------------------------------------------------------------------------------
hrat                                                                                                                  (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1,72]                       units:  .01
         unique values:  451                      missing .:  0/1,989

                  mean:   24.7909
              std. dev:   7.11946

           percentiles:        10%       25%       50%       75%       90%
                              15.7        21     25.77        29        32

---------------------------------------------------------------------------------------------------------------------------------
married                                                                                                               (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  3/1,989

            tabulation:  Freq.  Value
                           678  0
                         1,308  1
                             3  .

---------------------------------------------------------------------------------------------------------------------------------
dep                                                                                                                   (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,8]                        units:  1
         unique values:  9                        missing .:  3/1,989

            tabulation:  Freq.  Value
                         1,175  0
                           317  1
                           327  2
                           126  3
                            31  4
                             5  5
                             3  6
                             1  7
                             1  8
                             3  .

---------------------------------------------------------------------------------------------------------------------------------
sch                                                                                                                   (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                           454  0
                         1,535  1

---------------------------------------------------------------------------------------------------------------------------------
chist                                                                                                                 (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                           323  0
                         1,666  1

---------------------------------------------------------------------------------------------------------------------------------
pubrec                                                                                                                (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,852  0
                           137  1

---------------------------------------------------------------------------------------------------------------------------------
mortno                                                                                                                (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,329  0
                           660  1

---------------------------------------------------------------------------------------------------------------------------------
vr                                                                                                                    (unlabeled)
---------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1,989

            tabulation:  Freq.  Value
                         1,174  0
                           815  1

. 
. eststo clear

. * Unrestricted model
. probit approve i.male i.black i.hispan atotinc yjob unem hrat i.married ///
>         dep i.sch i.chis i.pubrec i.mortno i.vr 

Iteration 0:   log likelihood = -737.97933  
Iteration 1:   log likelihood = -622.87781  
Iteration 2:   log likelihood = -621.16706  
Iteration 3:   log likelihood =  -621.1627  
Iteration 4:   log likelihood =  -621.1627  

Probit regression                               Number of obs     =      1,971
                                                LR chi2(14)       =     233.63
                                                Prob > chi2       =     0.0000
Log likelihood =  -621.1627                     Pseudo R2         =     0.1583

------------------------------------------------------------------------------
     approve |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.male |  -.0678119   .1073585    -0.63   0.528    -.2782307    .1426069
     1.black |  -.6293595   .1122893    -5.60   0.000    -.8494426   -.4092765
    1.hispan |  -.5563369   .1481497    -3.76   0.000     -.846705   -.2659687
     atotinc |  -4.26e-06   8.27e-06    -0.52   0.606    -.0000205     .000012
        yjob |  -.0322219   .0364769    -0.88   0.377    -.1037153    .0392715
        unem |  -.0430823    .017029    -2.53   0.011    -.0764586    -.009706
        hrat |  -.0141185   .0055879    -2.53   0.012    -.0250707   -.0031663
   1.married |   .2580886   .0932543     2.77   0.006     .0753135    .4408637
         dep |  -.0535007   .0384108    -1.39   0.164    -.1287845    .0217831
       1.sch |   .0190826   .0942186     0.20   0.839    -.1655824    .2037477
     1.chist |    .600732   .0953689     6.30   0.000     .4138124    .7876516
    1.pubrec |  -.8261174   .1252755    -6.59   0.000    -1.071653    -.580582
    1.mortno |    .227241   .0936222     2.43   0.015     .0437448    .4107372
        1.vr |  -.2024178   .0801612    -2.53   0.012    -.3595308   -.0453047
       _cons |   1.423926   .2316631     6.15   0.000     .9698745    1.877977
------------------------------------------------------------------------------

. * Marginal effects at the mean
. margins, dydx(*) atmeans

Conditional marginal effects                    Number of obs     =      1,971
Model VCE    : OIM

Expression   : Pr(approve), predict()
dy/dx w.r.t. : 1.male 1.black 1.hispan atotinc yjob unem hrat 1.married dep 1.sch 1.chist 1.pubrec 1.mortno 1.vr
at           : 0.male          =    .1867073 (mean)
               1.male          =    .8132927 (mean)
               0.black         =    .9010654 (mean)
               1.black         =    .0989346 (mean)
               0.hispan        =    .9452055 (mean)
               1.hispan        =    .0547945 (mean)
               atotinc         =     5201.98 (mean)
               yjob            =    .4454592 (mean)
               unem            =    3.888534 (mean)
               hrat            =    24.80008 (mean)
               0.married       =    .3404363 (mean)
               1.married       =    .6595637 (mean)
               dep             =    .7716895 (mean)
               0.sch           =    .2298326 (mean)
               1.sch           =    .7701674 (mean)
               0.chist         =    .1633688 (mean)
               1.chist         =    .8366312 (mean)
               0.pubrec        =    .9315068 (mean)
               1.pubrec        =    .0684932 (mean)
               0.mortno        =    .6666667 (mean)
               1.mortno        =    .3333333 (mean)
               0.vr            =    .5920852 (mean)
               1.vr            =    .4079148 (mean)

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.male |  -.0112339   .0172876    -0.65   0.516    -.0451171    .0226492
     1.black |  -.1445655   .0323648    -4.47   0.000    -.2079994   -.0811317
    1.hispan |  -.1271327   .0423657    -3.00   0.003    -.2101679   -.0440975
     atotinc |  -7.26e-07   1.41e-06    -0.52   0.606    -3.49e-06    2.04e-06
        yjob |  -.0054884   .0062096    -0.88   0.377     -.017659    .0066821
        unem |  -.0073383    .002893    -2.54   0.011    -.0130085   -.0016682
        hrat |  -.0024048   .0009498    -2.53   0.011    -.0042664   -.0005433
   1.married |   .0464244   .0176015     2.64   0.008     .0119262    .0809227
         dep |  -.0091129   .0065305    -1.40   0.163    -.0219125    .0036867
       1.sch |   .0032723   .0162648     0.20   0.841    -.0286061    .0351507
     1.chist |   .1309191   .0251368     5.21   0.000      .081652    .1801863
    1.pubrec |  -.2095639   .0417705    -5.02   0.000    -.2914325   -.1276953
    1.mortno |   .0368774   .0144075     2.56   0.010     .0086393    .0651156
        1.vr |  -.0353603   .0142989    -2.47   0.013    -.0633857   -.0073349
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.

. * Average marginal effects
. margins, dydx(*)

Average marginal effects                        Number of obs     =      1,971
Model VCE    : OIM

Expression   : Pr(approve), predict()
dy/dx w.r.t. : 1.male 1.black 1.hispan atotinc yjob unem hrat 1.married dep 1.sch 1.chist 1.pubrec 1.mortno 1.vr

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.male |  -.0113835   .0176271    -0.65   0.518     -.045932     .023165
     1.black |  -.1398192    .030467    -4.59   0.000    -.1995334   -.0801049
    1.hispan |  -.1210048   .0389159    -3.11   0.002    -.1972785   -.0447311
     atotinc |  -7.31e-07   1.42e-06    -0.52   0.606    -3.51e-06    2.05e-06
        yjob |  -.0055276   .0062564    -0.88   0.377    -.0177899    .0067347
        unem |  -.0073907   .0029172    -2.53   0.011    -.0131082   -.0016732
        hrat |   -.002422   .0009582    -2.53   0.011       -.0043    -.000544
   1.married |    .046081   .0172747     2.67   0.008     .0122232    .0799388
         dep |   -.009178   .0065874    -1.39   0.164    -.0220891    .0037332
       1.sch |   .0032906   .0163325     0.20   0.840    -.0287204    .0353016
     1.chist |   .1283159   .0242038     5.30   0.000     .0808774    .1757544
    1.pubrec |  -.2025424   .0393417    -5.15   0.000    -.2796507   -.1254341
    1.mortno |   .0373937    .014732     2.54   0.011     .0085196    .0662678
        1.vr |  -.0354035   .0142508    -2.48   0.013    -.0633345   -.0074724
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.

. 
. est store unr

. scalar ll_unr = e(ll)

. 
. * Find 95% critical value
. scalar chi2_cv = invchi2tail(5, 0.05)

. 
. /* 
> Run the restricted model and retrieve log_likelihood to construct
> lr = 2 * (loglike_unr - loglike_res).
> Compare the results with -lrtest-
> Run the restricted model by adding 
> -if ~missing(male black hispan atotinc yjob unem hrat married dep sch chis pubrec mortno vr)-
> to make sure the two models use the same observations.
> */
. 
. 
. log close
      name:  <unnamed>
       log:  D:\Dropbox\2019S\571\ECON571_lab_2019S\Lab\logs/Lab8.log
  log type:  text
 closed on:   2 Apr 2019, 11:34:22
---------------------------------------------------------------------------------------------------------------------------------
