-------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\wsr\Dropbox\2019S\571\ECON571_lab_2019S\Lab\logs/HW8.log
  log type:  text
 opened on:   5 Apr 2019, 10:55:37

. use data/loanapp

. * http://fmwww.bc.edu/ec-p/data/wooldridge/loanapp.des
. 
. * Check for missing values
. codebook approve male black hispan atotinc yjob unem hrat married ///
>         dep sch chis pubrec mortno vr

-------------------------------------------------------------------------------------------------------------------------------------------
approve                                                                                                                         (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                           244  0
                          1745  1

-------------------------------------------------------------------------------------------------------------------------------------------
male                                                                                                                            (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  15/1989

            tabulation:  Freq.  Value
                           369  0
                          1605  1
                            15  .

-------------------------------------------------------------------------------------------------------------------------------------------
black                                                                                                                           (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1792  0
                           197  1

-------------------------------------------------------------------------------------------------------------------------------------------
hispan                                                                                                                          (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1878  0
                           111  1

-------------------------------------------------------------------------------------------------------------------------------------------
atotinc                                                                                                                         (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,81000]                    units:  1
         unique values:  1349                     missing .:  0/1989

                  mean:   5195.55
              std. dev:   5269.06

           percentiles:        10%       25%       50%       75%       90%
                              2235      2876      3813      5596      8881

-------------------------------------------------------------------------------------------------------------------------------------------
yjob                                                                                                                            (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,9]                        units:  1
         unique values:  4                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1364  0
                           581  1
                            28  6
                            16  9

-------------------------------------------------------------------------------------------------------------------------------------------
unem                                                                                                                            (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1.8,10.6]                   units:  .1
         unique values:  10                       missing .:  0/1989

                  mean:    3.8823
              std. dev:   2.16413

           percentiles:        10%       25%       50%       75%       90%
                                 2       3.1       3.2       3.9       5.3

-------------------------------------------------------------------------------------------------------------------------------------------
hrat                                                                                                                            (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1,72]                       units:  .01
         unique values:  451                      missing .:  0/1989

                  mean:   24.7909
              std. dev:   7.11946

           percentiles:        10%       25%       50%       75%       90%
                              15.7        21     25.77        29        32

-------------------------------------------------------------------------------------------------------------------------------------------
married                                                                                                                         (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  3/1989

            tabulation:  Freq.  Value
                           678  0
                          1308  1
                             3  .

-------------------------------------------------------------------------------------------------------------------------------------------
dep                                                                                                                             (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,8]                        units:  1
         unique values:  9                        missing .:  3/1989

            tabulation:  Freq.  Value
                          1175  0
                           317  1
                           327  2
                           126  3
                            31  4
                             5  5
                             3  6
                             1  7
                             1  8
                             3  .

-------------------------------------------------------------------------------------------------------------------------------------------
sch                                                                                                                             (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                           454  0
                          1535  1

-------------------------------------------------------------------------------------------------------------------------------------------
chist                                                                                                                           (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                           323  0
                          1666  1

-------------------------------------------------------------------------------------------------------------------------------------------
pubrec                                                                                                                          (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1852  0
                           137  1

-------------------------------------------------------------------------------------------------------------------------------------------
mortno                                                                                                                          (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1329  0
                           660  1

-------------------------------------------------------------------------------------------------------------------------------------------
vr                                                                                                                              (unlabeled)
-------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [0,1]                        units:  1
         unique values:  2                        missing .:  0/1989

            tabulation:  Freq.  Value
                          1174  0
                           815  1

. 
. eststo clear

. * Unrestricted model
. probit approve i.male i.black i.hispan atotinc yjob unem hrat i.married ///
>         dep i.sch i.chis i.pubrec i.mortno i.vr 

Iteration 0:   log likelihood = -737.97933  
Iteration 1:   log likelihood = -622.87781  
Iteration 2:   log likelihood = -621.16706  
Iteration 3:   log likelihood =  -621.1627  
Iteration 4:   log likelihood =  -621.1627  

Probit regression                                 Number of obs   =       1971
                                                  LR chi2(14)     =     233.63
                                                  Prob > chi2     =     0.0000
Log likelihood =  -621.1627                       Pseudo R2       =     0.1583

------------------------------------------------------------------------------
     approve |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      1.male |  -.0678119   .1073585    -0.63   0.528    -.2782307    .1426069
     1.black |  -.6293595   .1122893    -5.60   0.000    -.8494426   -.4092765
    1.hispan |  -.5563369   .1481497    -3.76   0.000     -.846705   -.2659687
     atotinc |  -4.26e-06   8.27e-06    -0.52   0.606    -.0000205     .000012
        yjob |  -.0322219   .0364769    -0.88   0.377    -.1037153    .0392715
        unem |  -.0430823    .017029    -2.53   0.011    -.0764586    -.009706
        hrat |  -.0141185   .0055879    -2.53   0.012    -.0250707   -.0031663
   1.married |   .2580886   .0932543     2.77   0.006     .0753135    .4408637
         dep |  -.0535007   .0384108    -1.39   0.164    -.1287845    .0217831
       1.sch |   .0190826   .0942186     0.20   0.839    -.1655824    .2037477
     1.chist |    .600732   .0953689     6.30   0.000     .4138124    .7876516
    1.pubrec |  -.8261174   .1252755    -6.59   0.000    -1.071653    -.580582
    1.mortno |    .227241   .0936222     2.43   0.015     .0437448    .4107372
        1.vr |  -.2024178   .0801612    -2.53   0.012    -.3595308   -.0453047
       _cons |   1.423926   .2316631     6.15   0.000     .9698745    1.877977
------------------------------------------------------------------------------

. est store unr

. scalar ll_unr = e(ll)

. 
. * Restricted model
. probit approve i.black i.hispan unem hrat i.married i.chis i.pubrec i.mortno i.vr /// 
>         if ~missing(male, black, hispan, atotinc, yjob, unem, hrat, married, dep, ///
>         sch, chis, pubrec, mortno, vr)

Iteration 0:   log likelihood = -737.97933  
Iteration 1:   log likelihood = -624.47578  
Iteration 2:   log likelihood = -622.91235  
Iteration 3:   log likelihood = -622.90873  
Iteration 4:   log likelihood = -622.90873  

Probit regression                                 Number of obs   =       1971
                                                  LR chi2(9)      =     230.14
                                                  Prob > chi2     =     0.0000
Log likelihood = -622.90873                       Pseudo R2       =     0.1559

------------------------------------------------------------------------------
     approve |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     1.black |  -.6247657   .1111776    -5.62   0.000    -.8426698   -.4068615
    1.hispan |  -.5570842   .1467912    -3.80   0.000    -.8447897   -.2693788
        unem |  -.0442126   .0167192    -2.64   0.008    -.0769815   -.0114436
        hrat |  -.0133374   .0053464    -2.49   0.013    -.0238161   -.0028587
   1.married |   .1938373   .0824453     2.35   0.019     .0322474    .3554271
     1.chist |   .5949584   .0950196     6.26   0.000     .4087234    .7811934
    1.pubrec |  -.8426293   .1248174    -6.75   0.000    -1.087267   -.5979916
    1.mortno |   .2127854   .0924229     2.30   0.021     .0316398    .3939309
        1.vr |  -.1973757   .0798277    -2.47   0.013     -.353835   -.0409163
       _cons |   1.337351   .1890176     7.08   0.000     .9668837    1.707819
------------------------------------------------------------------------------

. est store res

. scalar ll_res = e(ll)

. 
. * Calculate likelihood ratio
. scalar lr = 2*(ll_unr - ll_res)

. * Find 95% critical value
. scalar chi2_cv = invchi2tail(5, 0.05)

. display "The likelihood ratio is " lr ". The critical value of chi2(5) at 5% is " chi2_cv
The likelihood ratio is 3.4920543. The critical value of chi2(5) at 5% is 11.070498

. 
. * Compare the results with -lrtest-
. lrtest unr res

Likelihood-ratio test                                 LR chi2(5)  =      3.49
(Assumption: res nested in unr)                       Prob > chi2 =    0.6246

. 
. * -test- is based on Wald test, the result is slightly different
. quietly probit approve i.male i.black i.hispan atotinc yjob unem hrat i.married ///
>         dep i.sch i.chis i.pubrec i.mortno i.vr

. test 1.male atotinc yjob dep 1.sch

 ( 1)  [approve]1.male = 0
 ( 2)  [approve]atotinc = 0
 ( 3)  [approve]yjob = 0
 ( 4)  [approve]dep = 0
 ( 5)  [approve]1.sch = 0

           chi2(  5) =    3.55
         Prob > chi2 =    0.6162

. 
. quietly probit approve i.black i.hispan unem hrat i.married i.chis i.pubrec i.mortno i.vr /// 
>         if ~missing(male, black, hispan, atotinc, yjob, unem, hrat, married, dep, ///
>         sch, chis, pubrec, mortno, vr)

. * Marginal effects at the mean
. margins, dydx(*) atmeans

Conditional marginal effects                      Number of obs   =       1971
Model VCE    : OIM

Expression   : Pr(approve), predict()
dy/dx w.r.t. : 1.black 1.hispan unem hrat 1.married 1.chist 1.pubrec 1.mortno 1.vr
at           : 0.black         =    .9010654 (mean)
               1.black         =    .0989346 (mean)
               0.hispan        =    .9452055 (mean)
               1.hispan        =    .0547945 (mean)
               unem            =    3.888534 (mean)
               hrat            =    24.80008 (mean)
               0.married       =    .3404363 (mean)
               1.married       =    .6595637 (mean)
               0.chist         =    .1633688 (mean)
               1.chist         =    .8366312 (mean)
               0.pubrec        =    .9315068 (mean)
               1.pubrec        =    .0684932 (mean)
               0.mortno        =    .6666667 (mean)
               1.mortno        =    .3333333 (mean)
               0.vr            =    .5920852 (mean)
               1.vr            =    .4079148 (mean)

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     1.black |  -.1438257   .0320551    -4.49   0.000    -.2066525   -.0809988
    1.hispan |  -.1278747   .0421342    -3.03   0.002    -.2104561   -.0452932
        unem |  -.0075704   .0028546    -2.65   0.008    -.0131653   -.0019755
        hrat |  -.0022837   .0009134    -2.50   0.012    -.0040739   -.0004936
   1.married |    .034569   .0152541     2.27   0.023     .0046716    .0644665
     1.chist |   .1299419   .0250638     5.18   0.000     .0808177    .1790661
    1.pubrec |  -.2158484   .0419993    -5.14   0.000    -.2981654   -.1335314
    1.mortno |   .0348216   .0143822     2.42   0.015      .006633    .0630102
        1.vr |  -.0346349   .0142983    -2.42   0.015    -.0626591   -.0066107
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.

. * Average marginal effects
. margins, dydx(*)

Average marginal effects                          Number of obs   =       1971
Model VCE    : OIM

Expression   : Pr(approve), predict()
dy/dx w.r.t. : 1.black 1.hispan unem hrat 1.married 1.chist 1.pubrec 1.mortno 1.vr

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     1.black |  -.1390484   .0302137    -4.60   0.000    -.1982661   -.0798306
    1.hispan |  -.1216569   .0387425    -3.14   0.002    -.1975908   -.0457231
        unem |  -.0076075   .0028735    -2.65   0.008    -.0132395   -.0019755
        hrat |  -.0022949   .0009198    -2.49   0.013    -.0040977   -.0004921
   1.married |   .0343553   .0150182     2.29   0.022     .0049202    .0637903
     1.chist |   .1273348    .024157     5.27   0.000     .0799879    .1746817
    1.pubrec |  -.2085973    .039614    -5.27   0.000    -.2862394   -.1309552
    1.mortno |   .0351915   .0146475     2.40   0.016     .0064829    .0639001
        1.vr |  -.0346164   .0142295    -2.43   0.015    -.0625057   -.0067272
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.

. 
. log close
      name:  <unnamed>
       log:  C:\Users\wsr\Dropbox\2019S\571\ECON571_lab_2019S\Lab\logs/HW8.log
  log type:  text
 closed on:   5 Apr 2019, 10:55:39
-------------------------------------------------------------------------------------------------------------------------------------------
